# Converting Bytecode into Assembly

`jvm` has an optional `--asm linux` or `--asm macos` flag which, instead of executing the class, attempts to convert it into x64 assembly for respectively Linux or macOS (Intel notation, not AT&T). If successful, a `<class>.asm` file gets created which can be compiled by [nasm](https://www.nasm.us/) or [yasm](https://yasm.tortall.net/). The current limitations are:

- The class `main()` method only gets converted
- The only methods that can called inside `main()` are `System.out.print()` and `System.out.println()`
- Only integer operations are supported

```
> cat java/Circle.java 
class Circle {
    public static void main(String[] args) {
        for (int j=0; j<51; j++) {
            for (int i=0; i<120; i++) {
                int c_x = (i-60) / 2;
                int c_y = j-25;

                String output = ".";
                if (c_x*c_x + c_y*c_y < 256) {
                    output = "X";
                }
                System.out.print(output);
            }
            System.out.println("");
        }
    }
}
> ./target/debug/jvm --asm Circle
Bytecode class compiled into x64 assembly, Intel notation (Circle.asm)
> head Circle.asm 
    global    start
    section   .text
start:
    push 0x0
    pop r9
__branch2:
    push r9
    push 0x33
    pop rbx
    pop rax 
```

To build it on macOS:

```
> yasm -f macho64 Circle.asm 
> ld -macosx_version_min 10.7.0 -o Circle Circle.o
```

To build it on Linux:

```
> yasm -f elf64 Circle.asm
> ld -o Circle Circle.o
```

To execute it:

```
> ./Circle 
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
..................................................XXXXXXXXXXXXXXXXXXXXXX................................................
..............................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................................
..........................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX........................................
........................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX......................................
......................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX....................................
....................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX..................................
..................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX................................
..................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX................................
................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX..............................
................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX..............................
..............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................
..............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................
..............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................
..............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................
..............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................
..............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................
..............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................
..............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................
..............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................
..............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................
..............................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................
................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX..............................
................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX..............................
..................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX................................
..................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX................................
....................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX..................................
......................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX....................................
........................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX......................................
..........................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX........................................
..............................................XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX............................................
..................................................XXXXXXXXXXXXXXXXXXXXXX................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
........................................................................................................................
```
